<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>운동량 시뮬레이션</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { display: flex; flex-direction: row; font-family: sans-serif; }
    #simCanvas { border: 1px solid #ccc; margin-right: 20px; }
    #graph { width: 600px; height: 500px; }
    input[type="range"] { width: 400px; }
  </style>
</head>
<body>
  <div>
    <div id="simCanvas"></div>
    <div>
      <label>시간: <span id="timeLabel">0.00</span>초</label><br />
      <input type="range" id="timeSlider" min="0" max="3" step="0.01" value="0" />
    </div>
  </div>
  <div id="graph"></div>

  <script>
    let m = 1.0;
    let g = 9.8;
    let h = 5.0;
    let v = Math.sqrt(2 * g * h);
    let fallTime = v / g;
    let p = m * v;
    let dt_soft = 0.1;
    let dt_hard = 0.01;
    let simTime = 0;
    let playing = true;

    function setup() {
      let canvas = createCanvas(400, 350);
      canvas.parent("simCanvas");
      setInterval(updateGraph, 50);

      document.getElementById("timeSlider").addEventListener("input", (e) => {
        simTime = parseFloat(e.target.value);
        playing = false;
      });
    }

    function draw() {
      background(255);
      let eggStartY = 50;
      let groundY = 300;
      let eggSize = 30;

      if (playing) {
        simTime += deltaTime / 1000;
        document.getElementById("timeSlider").value = simTime.toFixed(2);
      }
      document.getElementById("timeLabel").textContent = simTime.toFixed(2);

      // 두 개의 물체 위치 계산
      let y1 = simTime < fallTime ? eggStartY + (groundY - eggStartY) * (simTime / fallTime) : groundY;
      let y2 = simTime < fallTime ? eggStartY + (groundY - eggStartY) * (simTime / fallTime) : groundY;

      // 맨땅 달걀
      fill(200, 0, 0);
      ellipse(width / 4, y1, eggSize, eggSize);
      fill(80);
      rect(width / 4 - 25, groundY + 15, 50, 10);
      textAlign(CENTER);
      text("맨땅", width / 4, groundY + 40);

      // 방석 달걀
      fill(0, 100, 200);
      ellipse((3 * width) / 4, y2, eggSize, eggSize);
      fill(150, 150, 250);
      rect((3 * width) / 4 - 30, groundY + 10, 60, 15, 10); // 방석 모양
      textAlign(CENTER);
      text("방석", (3 * width) / 4, groundY + 40);
    }

    function updateGraph() {
      let t = simTime;
      let v_t = t < fallTime ? g * t : 0;
      let p_t = m * v_t;
      let I_t = t >= fallTime ? p : 0;
      let F_soft = p / dt_soft;
      let F_hard = p / dt_hard;
      let F_soft_t = (t >= fallTime && t <= fallTime + dt_soft) ? F_soft : 0;
      let F_hard_t = (t >= fallTime && t <= fallTime + dt_hard) ? F_hard : 0;

      Plotly.react("graph", [
        {
          x: [t], y: [p_t], name: '운동량 p', mode: 'markers+lines', line: { color: 'blue' }
        },
        {
          x: [t], y: [I_t], name: '충격량 I', mode: 'markers+lines', line: { color: 'orange' }
        },
        {
          x: [t], y: [F_soft_t], name: '충격력 F - 방석', mode: 'markers+lines', line: { color: 'green' }
        },
        {
          x: [t], y: [F_hard_t], name: '충격력 F - 맨땅', mode: 'markers+lines', line: { color: 'red' }
        },
        {
          x: [t], y: [v_t], name: '속력 v', mode: 'markers+lines', line: { color: 'purple' }
        }
      ], {
        margin: { t: 10 },
        xaxis: { title: '시간 (s)', range: [0, 3] },
        yaxis: { title: '값', range: [0, 1100] },
        legend: { orientation: 'h' }
      });
    }
  </script>
</body>
</html>
