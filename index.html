<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>운동량 시뮬레이션</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { display: flex; flex-direction: row; }
    #simCanvas { border: 1px solid #ccc; }
    #graph { width: 600px; height: 500px; margin-left: 20px; }
  </style>
</head>
<body>
  <div>
    <div id="simCanvas"></div>
    <input type="range" id="timeSlider" min="0" max="3" step="0.01" value="0" />
    <div>
      <label><input type="radio" name="surface" value="soft" checked /> 방석</label>
      <label><input type="radio" name="surface" value="hard" /> 맨땅</label>
    </div>
  </div>
  <div id="graph"></div>

  <script>
    let m = 1.0;
    let g = 9.8;
    let h = 5.0;
    let v = Math.sqrt(2 * g * h);
    let fallTime = v / g;
    let p = m * v;
    let dt_soft = 0.1;
    let dt_hard = 0.01;
    let canvas;
    let eggY, startY = 50, groundY = 300;
    let simTime = 0;
    let playing = true;

    function setup() {
      canvas = createCanvas(200, 350);
      canvas.parent("simCanvas");
      eggY = startY;

      document.getElementById("timeSlider").addEventListener("input", (e) => {
        simTime = parseFloat(e.target.value);
        playing = false;
      });

      setInterval(updateGraph, 50);
    }

    function draw() {
      background(255);
      let surface = document.querySelector('input[name="surface"]:checked').value;
      let dt = surface === "soft" ? dt_soft : dt_hard;
      let F = p / dt;

      // 위치 계산
      if (playing) {
        simTime += deltaTime / 1000;
        document.getElementById("timeSlider").value = simTime.toFixed(2);
      }
      let y;
      if (simTime < fallTime) {
        y = startY + (groundY - startY) * (simTime / fallTime);
      } else {
        y = groundY;
      }

      // 달걀 그리기
      fill(200, 150, 0);
      ellipse(width / 2, y, 30, 40);

      // 바닥
      fill(100);
      rect(0, groundY + 20, width, 10);
    }

    function updateGraph() {
      let t = simTime;
      let surface = document.querySelector('input[name="surface"]:checked').value;
      let dt = surface === "soft" ? dt_soft : dt_hard;
      let F = p / dt;

      let v_t = t < fallTime ? g * t : 0;
      let p_t = m * v_t;
      let I_t = t >= fallTime ? p : 0;
      let F_t = (t >= fallTime && t <= fallTime + dt) ? F : 0;

      Plotly.react("graph", [{
        x: [t], y: [p_t], name: '운동량 p', mode: 'markers+lines'
      }, {
        x: [t], y: [I_t], name: '충격량 I', mode: 'markers+lines'
      }, {
        x: [t], y: [F_t], name: '충격력 F', mode: 'markers+lines'
      }, {
        x: [t], y: [v_t], name: '속력 v', mode: 'markers+lines'
      }], {
        margin: { t: 10 },
        xaxis: { title: "시간 (s)", range: [0, 3] },
        yaxis: { title: "값", range: [0, Math.max(1000, F)] }
      });
    }
  </script>
</body>
</html>
